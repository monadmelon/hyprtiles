<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyprTiles</title>
    <link href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', system-ui, sans-serif;
            background: #1C1C1E;
            -webkit-font-smoothing: antialiased;
        }
        
        #map { 
            position: absolute; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
        }
        
        .controls {
            position: absolute; 
            top: 16px; left: 16px; 
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 8px 24px rgba(0, 0, 0, 0.08);
            min-width: 200px;
        }
        
        .dark .panel {
            background: rgba(44, 44, 46, 0.92);
            color: #fff;
        }
        
        .brand {
            font-size: 17px;
            font-weight: 600;
            letter-spacing: -0.4px;
            margin-bottom: 2px;
        }
        
        .subtitle { 
            font-size: 13px; 
            color: rgba(0, 0, 0, 0.5);
            letter-spacing: -0.1px;
            margin-bottom: 14px;
        }
        
        .dark .subtitle { color: rgba(255, 255, 255, 0.5); }
        
        .toggle-group {
            display: flex;
            background: rgba(0, 0, 0, 0.06);
            padding: 2px;
            border-radius: 9px;
        }
        
        .dark .toggle-group {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .toggle-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 7px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            background: transparent;
            color: rgba(0, 0, 0, 0.5);
            letter-spacing: -0.1px;
        }
        
        .dark .toggle-btn {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .toggle-btn.active {
            background: #fff;
            color: #000;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .dark .toggle-btn.active {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        
        .info-panel {
            font-size: 12px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }
        
        .info-label { 
            color: rgba(0, 0, 0, 0.45);
            font-weight: 400;
        }
        
        .dark .info-label { color: rgba(255, 255, 255, 0.45); }
        
        .info-value { 
            font-weight: 500;
            font-variant-numeric: tabular-nums;
            font-feature-settings: "tnum";
        }
        
        .places-panel {
            max-height: 180px;
            overflow-y: auto;
        }
        
        .place-btn {
            width: 100%;
            padding: 10px 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 400;
            cursor: pointer;
            text-align: left;
            background: transparent;
            color: inherit;
            transition: background 0.15s;
            letter-spacing: -0.2px;
        }
        
        .place-btn:hover {
            background: rgba(0, 0, 0, 0.04);
        }
        
        .dark .place-btn:hover {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .place-btn:active {
            background: rgba(0, 0, 0, 0.08);
        }
        
        .dark .place-btn:active {
            background: rgba(255, 255, 255, 0.12);
        }

        .maplibregl-ctrl-group {
            border-radius: 10px !important;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
            border: none !important;
        }
        
        .maplibregl-ctrl-group button {
            width: 36px !important;
            height: 36px !important;
            border: none !important;
        }
        
        .maplibregl-ctrl-attrib {
            font-size: 10px;
            background: rgba(255, 255, 255, 0.7) !important;
            backdrop-filter: blur(8px);
        }
        
        .dark .maplibregl-ctrl-attrib {
            background: rgba(0, 0, 0, 0.5) !important;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .dark .maplibregl-ctrl-attrib a {
            color: rgba(255, 255, 255, 0.6);
        }
    </style>
</head>
<body class="dark">
    <div id="map"></div>
    
    <div class="controls">
        <div class="panel">
            <div class="brand">HyprTiles</div>
            <p class="subtitle">Kerala</p>
            
            <div class="toggle-group">
                <button class="toggle-btn" onclick="setTheme('light')">Light</button>
                <button class="toggle-btn active" onclick="setTheme('dark')">Dark</button>
            </div>
        </div>

        <div class="panel info-panel">
            <div class="info-row">
                <span class="info-label">Zoom</span>
                <span class="info-value" id="zoom">8.0</span>
            </div>
            <div class="info-row">
                <span class="info-label">Center</span>
                <span class="info-value" id="center">10.85, 76.27</span>
            </div>
        </div>
        
        <div class="panel places-panel">
            <button class="place-btn" onclick="flyTo([76.9366, 8.5241], 13)">Thiruvananthapuram</button>
            <button class="place-btn" onclick="flyTo([76.2673, 9.9312], 13)">Kochi</button>
            <button class="place-btn" onclick="flyTo([75.7804, 11.2588], 13)">Kozhikode</button>
            <button class="place-btn" onclick="flyTo([76.7156, 8.7379], 15)">Varkala</button>
            <button class="place-btn" onclick="flyTo([77.0609, 10.7867], 13)">Munnar</button>
        </div>
    </div>

    <script>
        const TILE_SERVER = 'http://localhost:3000';
        let map, currentTheme = 'dark';

        const themes = {
            light: {
                background: '#EAE6E1',
                landuse: '#E2DED8',
                water: '#A0C4E1',
                waterway: '#A0C4E1',
                park: '#C2D9B5',
                forest: '#C8D9C0',
                sand: '#F0E4D4',
                building: '#D8D4CE',
                buildingOutline: '#C8C4BE',
                roadMotorway: '#F5B83D',
                roadMotorwayCasing: '#E5A020',
                roadPrimary: '#FFFFFF',
                roadPrimaryCasing: '#D0CCC4',
                roadSecondary: '#FFFFFF',
                roadSecondaryCasing: '#DCD8D0',
                roadMinor: '#FFFFFF',
                roadMinorCasing: '#E4E0D8',
                textPrimary: '#2C2C2E',
                textSecondary: '#6C6C70',
                textHalo: '#FFFFFF'
            },
            dark: {
                background: '#18181A',
                landuse: '#222224',
                water: '#183040',
                waterway: '#183040',
                park: '#1A2E1A',
                forest: '#162816',
                sand: '#2E2820',
                building: '#28282A',
                buildingOutline: '#323234',
                roadMotorway: '#A87D15',
                roadMotorwayCasing: '#18181A',
                roadPrimary: '#404042',
                roadPrimaryCasing: '#18181A',
                roadSecondary: '#353537',
                roadSecondaryCasing: '#18181A',
                roadMinor: '#2E2E30',
                roadMinorCasing: '#18181A',
                textPrimary: '#E5E5E7',
                textSecondary: '#8E8E93',
                textHalo: '#18181A'
            }
        };

        function getStyle(theme) {
            const c = themes[theme];
            
            return {
                version: 8,
                sources: {
                    kerala: {
                        type: 'vector',
                        tiles: [`${TILE_SERVER}/kerala/{z}/{x}/{y}`],
                        maxzoom: 14
                    }
                },
                glyphs: 'https://fonts.openmaptiles.org/{fontstack}/{range}.pbf',
                layers: [
                    { id: 'background', type: 'background', paint: { 'background-color': c.background }},
                    
                    { id: 'landuse', type: 'fill', source: 'kerala', 'source-layer': 'landuse',
                        paint: { 'fill-color': c.landuse, 'fill-opacity': 0.7 }},
                    
                    { id: 'landcover-grass', type: 'fill', source: 'kerala', 'source-layer': 'landcover',
                        filter: ['==', 'class', 'grass'],
                        paint: { 'fill-color': c.park, 'fill-opacity': 0.5 }},
                    
                    { id: 'landcover-wood', type: 'fill', source: 'kerala', 'source-layer': 'landcover',
                        filter: ['in', 'class', 'wood', 'forest'],
                        paint: { 'fill-color': c.forest, 'fill-opacity': 0.6 }},
                    
                    { id: 'landcover-sand', type: 'fill', source: 'kerala', 'source-layer': 'landcover',
                        filter: ['==', 'class', 'sand'],
                        paint: { 'fill-color': c.sand }},
                    
                    { id: 'park', type: 'fill', source: 'kerala', 'source-layer': 'park',
                        paint: { 'fill-color': c.park, 'fill-opacity': 0.5 }},
                    
                    { id: 'water', type: 'fill', source: 'kerala', 'source-layer': 'water',
                        paint: { 'fill-color': c.water }},
                    
                    { id: 'waterway', type: 'line', source: 'kerala', 'source-layer': 'waterway',
                        paint: { 'line-color': c.waterway, 'line-width': ['interpolate', ['linear'], ['zoom'], 8, 0.5, 14, 3] }},
                    
                    { id: 'building', type: 'fill', source: 'kerala', 'source-layer': 'building', minzoom: 13,
                        paint: { 'fill-color': c.building, 'fill-opacity': ['interpolate', ['linear'], ['zoom'], 13, 0.3, 16, 0.85] }},
                    
                    { id: 'building-outline', type: 'line', source: 'kerala', 'source-layer': 'building', minzoom: 14,
                        paint: { 'line-color': c.buildingOutline, 'line-width': 0.5 }},
                    
                    // Road casings
                    { id: 'road-minor-casing', type: 'line', source: 'kerala', 'source-layer': 'transportation',
                        filter: ['all', ['==', '$type', 'LineString'], ['in', 'class', 'minor', 'service', 'track']], minzoom: 12,
                        layout: { 'line-cap': 'round', 'line-join': 'round' },
                        paint: { 'line-color': c.roadMinorCasing, 'line-width': ['interpolate', ['linear'], ['zoom'], 12, 2.5, 18, 16] }},
                    
                    { id: 'road-secondary-casing', type: 'line', source: 'kerala', 'source-layer': 'transportation',
                        filter: ['all', ['==', '$type', 'LineString'], ['in', 'class', 'secondary', 'tertiary']], minzoom: 9,
                        layout: { 'line-cap': 'round', 'line-join': 'round' },
                        paint: { 'line-color': c.roadSecondaryCasing, 'line-width': ['interpolate', ['linear'], ['zoom'], 9, 2.5, 18, 22] }},
                    
                    { id: 'road-primary-casing', type: 'line', source: 'kerala', 'source-layer': 'transportation',
                        filter: ['all', ['==', '$type', 'LineString'], ['==', 'class', 'primary']], minzoom: 7,
                        layout: { 'line-cap': 'round', 'line-join': 'round' },
                        paint: { 'line-color': c.roadPrimaryCasing, 'line-width': ['interpolate', ['linear'], ['zoom'], 7, 2, 18, 26] }},
                    
                    { id: 'road-motorway-casing', type: 'line', source: 'kerala', 'source-layer': 'transportation',
                        filter: ['all', ['==', '$type', 'LineString'], ['in', 'class', 'motorway', 'trunk']], minzoom: 5,
                        layout: { 'line-cap': 'round', 'line-join': 'round' },
                        paint: { 'line-color': c.roadMotorwayCasing, 'line-width': ['interpolate', ['linear'], ['zoom'], 5, 1.5, 18, 28] }},
                    
                    // Road fills
                    { id: 'road-minor', type: 'line', source: 'kerala', 'source-layer': 'transportation',
                        filter: ['all', ['==', '$type', 'LineString'], ['in', 'class', 'minor', 'service', 'track']], minzoom: 12,
                        layout: { 'line-cap': 'round', 'line-join': 'round' },
                        paint: { 'line-color': c.roadMinor, 'line-width': ['interpolate', ['linear'], ['zoom'], 12, 1.2, 18, 12] }},
                    
                    { id: 'road-secondary', type: 'line', source: 'kerala', 'source-layer': 'transportation',
                        filter: ['all', ['==', '$type', 'LineString'], ['in', 'class', 'secondary', 'tertiary']], minzoom: 9,
                        layout: { 'line-cap': 'round', 'line-join': 'round' },
                        paint: { 'line-color': c.roadSecondary, 'line-width': ['interpolate', ['linear'], ['zoom'], 9, 1.2, 18, 18] }},
                    
                    { id: 'road-primary', type: 'line', source: 'kerala', 'source-layer': 'transportation',
                        filter: ['all', ['==', '$type', 'LineString'], ['==', 'class', 'primary']], minzoom: 7,
                        layout: { 'line-cap': 'round', 'line-join': 'round' },
                        paint: { 'line-color': c.roadPrimary, 'line-width': ['interpolate', ['linear'], ['zoom'], 7, 1.2, 18, 22] }},
                    
                    { id: 'road-motorway', type: 'line', source: 'kerala', 'source-layer': 'transportation',
                        filter: ['all', ['==', '$type', 'LineString'], ['in', 'class', 'motorway', 'trunk']], minzoom: 5,
                        layout: { 'line-cap': 'round', 'line-join': 'round' },
                        paint: { 'line-color': c.roadMotorway, 'line-width': ['interpolate', ['linear'], ['zoom'], 5, 0.8, 18, 24] }},
                    
                    // Aeroways
                    { id: 'aeroway-runway', type: 'line', source: 'kerala', 'source-layer': 'aeroway',
                        filter: ['==', 'class', 'runway'], minzoom: 11,
                        paint: { 'line-color': theme === 'light' ? '#C0C0C0' : '#404042', 'line-width': ['interpolate', ['linear'], ['zoom'], 11, 3, 16, 18] }},
                    
                    // Labels
                    { id: 'place-city', type: 'symbol', source: 'kerala', 'source-layer': 'place',
                        filter: ['==', 'class', 'city'], minzoom: 5,
                        layout: { 'text-field': '{name}', 'text-font': ['Open Sans Bold'], 'text-size': ['interpolate', ['linear'], ['zoom'], 5, 13, 12, 22],
                            'text-transform': 'uppercase', 'text-letter-spacing': 0.08 },
                        paint: { 'text-color': c.textPrimary, 'text-halo-color': c.textHalo, 'text-halo-width': 1.5 }},
                    
                    { id: 'place-town', type: 'symbol', source: 'kerala', 'source-layer': 'place',
                        filter: ['==', 'class', 'town'], minzoom: 8,
                        layout: { 'text-field': '{name}', 'text-font': ['Open Sans Semibold'], 'text-size': ['interpolate', ['linear'], ['zoom'], 8, 11, 14, 16] },
                        paint: { 'text-color': c.textPrimary, 'text-halo-color': c.textHalo, 'text-halo-width': 1.2 }},
                    
                    { id: 'place-village', type: 'symbol', source: 'kerala', 'source-layer': 'place',
                        filter: ['in', 'class', 'village', 'hamlet', 'suburb', 'neighbourhood'], minzoom: 11,
                        layout: { 'text-field': '{name}', 'text-font': ['Open Sans Regular'], 'text-size': ['interpolate', ['linear'], ['zoom'], 11, 10, 16, 13] },
                        paint: { 'text-color': c.textSecondary, 'text-halo-color': c.textHalo, 'text-halo-width': 1 }},
                    
                    { id: 'road-label', type: 'symbol', source: 'kerala', 'source-layer': 'transportation_name', minzoom: 13,
                        layout: { 'text-field': '{name}', 'text-font': ['Open Sans Regular'], 'text-size': 10, 'symbol-placement': 'line', 'text-max-angle': 25 },
                        paint: { 'text-color': c.textSecondary, 'text-halo-color': c.textHalo, 'text-halo-width': 1.2 }},
                    
                    { id: 'aerodrome-label', type: 'symbol', source: 'kerala', 'source-layer': 'aerodrome_label', minzoom: 10,
                        layout: { 'text-field': ['get', 'name:latin'], 'text-font': ['Open Sans Semibold'], 'text-size': 11 },
                        paint: { 'text-color': theme === 'light' ? '#0066CC' : '#5AC8FA', 'text-halo-color': c.textHalo, 'text-halo-width': 1.5 }},
                    
                    { id: 'mountain-peak', type: 'symbol', source: 'kerala', 'source-layer': 'mountain_peak', minzoom: 11,
                        layout: { 'text-field': ['concat', ['get', 'name:latin'], '\n', ['to-string', ['get', 'ele']], ' m'], 'text-font': ['Open Sans Regular'], 'text-size': 10 },
                        paint: { 'text-color': theme === 'light' ? '#7A5230' : '#B8956E', 'text-halo-color': c.textHalo, 'text-halo-width': 1 }},
                    
                    { id: 'poi-hospital', type: 'symbol', source: 'kerala', 'source-layer': 'poi',
                        filter: ['==', 'class', 'hospital'], minzoom: 13,
                        layout: { 'text-field': ['get', 'name:latin'], 'text-font': ['Open Sans Regular'], 'text-size': 10, 'text-anchor': 'left', 'text-offset': [0.3, 0] },
                        paint: { 'text-color': theme === 'light' ? '#CC3333' : '#FF6B6B', 'text-halo-color': c.textHalo, 'text-halo-width': 1 }},
                    
                    { id: 'poi-school', type: 'symbol', source: 'kerala', 'source-layer': 'poi',
                        filter: ['in', 'class', 'school', 'college', 'university'], minzoom: 14,
                        layout: { 'text-field': ['get', 'name:latin'], 'text-font': ['Open Sans Regular'], 'text-size': 10 },
                        paint: { 'text-color': theme === 'light' ? '#5856D6' : '#AF52DE', 'text-halo-color': c.textHalo, 'text-halo-width': 1 }},
                    
                    { id: 'poi-worship', type: 'symbol', source: 'kerala', 'source-layer': 'poi',
                        filter: ['==', 'class', 'place_of_worship'], minzoom: 14,
                        layout: { 'text-field': ['get', 'name:latin'], 'text-font': ['Open Sans Regular'], 'text-size': 10 },
                        paint: { 'text-color': theme === 'light' ? '#8B6914' : '#C9A227', 'text-halo-color': c.textHalo, 'text-halo-width': 1 }},
                    
                    { id: 'poi-lodging', type: 'symbol', source: 'kerala', 'source-layer': 'poi',
                        filter: ['in', 'class', 'lodging', 'hotel'], minzoom: 14,
                        layout: { 'text-field': ['get', 'name:latin'], 'text-font': ['Open Sans Regular'], 'text-size': 10 },
                        paint: { 'text-color': theme === 'light' ? '#007AFF' : '#5AC8FA', 'text-halo-color': c.textHalo, 'text-halo-width': 1 }},
                    
                    { id: 'poi-transport', type: 'symbol', source: 'kerala', 'source-layer': 'poi',
                        filter: ['in', 'class', 'bus_station', 'railway'], minzoom: 12,
                        layout: { 'text-field': ['get', 'name:latin'], 'text-font': ['Open Sans Semibold'], 'text-size': 11 },
                        paint: { 'text-color': c.textPrimary, 'text-halo-color': c.textHalo, 'text-halo-width': 1.5 }}
                ]
            };
        }

        function setTheme(theme) {
            currentTheme = theme;
            document.body.classList.toggle('dark', theme === 'dark');
            
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (map) {
                const center = map.getCenter();
                const zoom = map.getZoom();
                map.setStyle(getStyle(theme));
                map.once('styledata', () => { map.setCenter(center); map.setZoom(zoom); });
            }
        }

        function flyTo(coords, zoom) {
            map.flyTo({ center: coords, zoom: zoom, duration: 1800 });
        }

        function updateInfo() {
            if (!map) return;
            const center = map.getCenter();
            document.getElementById('zoom').textContent = map.getZoom().toFixed(1);
            document.getElementById('center').textContent = `${center.lat.toFixed(2)}, ${center.lng.toFixed(2)}`;
        }

        map = new maplibregl.Map({
            container: 'map',
            style: getStyle('dark'),
            center: [76.2711, 10.8505],
            zoom: 8,
            maxBounds: [[73.5, 7.0], [80.5, 15.0]]
        });

        map.addControl(new maplibregl.NavigationControl({ showCompass: false }), 'bottom-right');
        map.addControl(new maplibregl.ScaleControl({ maxWidth: 80, unit: 'metric' }), 'bottom-left');
        map.addControl(new maplibregl.AttributionControl({ compact: true }), 'bottom-right');

        map.on('move', updateInfo);
        map.on('load', updateInfo);
    </script>
</body>
</html>
